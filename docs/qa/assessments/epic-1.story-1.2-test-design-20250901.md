# Test Design: Story epic-1.story-1.2 - 雙面板編輯器介面

Date: 2025-09-01  
Designer: Quinn (Test Architect)

## 測試策略總覽

- **測試情境總數**: 24 個
- **單元測試**: 12 個 (50%)
- **整合測試**: 6 個 (25%)
- **E2E 測試**: 6 個 (25%)
- **優先級分布**: P0: 8 個, P1: 10 個, P2: 6 個

## 依驗收標準分類的測試情境

### AC1: Monaco Editor 整合

整合 Monaco Editor 作為程式碼編輯器，支援 TypeScript/JavaScript 語法高亮，設定 Mermaid 語法高亮，配置程式碼自動補全功能

#### 測試情境

| ID           | 測試層級 | 優先級 | 測試描述                          | 理由                       |
| ------------ | -------- | ------ | --------------------------------- | -------------------------- |
| 1.2-UNIT-001 | 單元測試 | P0     | Mermaid 語言註冊與語法高亮        | 純邏輯功能，語言定義準確性 |
| 1.2-UNIT-002 | 單元測試 | P0     | 自動補全提供者功能                | 核心邏輯，補全建議準確性   |
| 1.2-UNIT-003 | 單元測試 | P1     | 主題定義與應用                    | 視覺呈現正確性             |
| 1.2-INT-001  | 整合測試 | P0     | Monaco Editor 與 Zustand 狀態整合 | 跨組件狀態同步             |
| 1.2-E2E-001  | E2E 測試 | P1     | 編輯器載入與語法高亮顯示          | 端到端使用者體驗           |

### AC2: 雙面板佈局設計

左右雙面板佈局，響應式設計支援不同螢幕尺寸，面板比例預設 50:50，可摺疊面板功能

#### 測試情境

| ID           | 測試層級 | 優先級 | 測試描述                    | 理由           |
| ------------ | -------- | ------ | --------------------------- | -------------- |
| 1.2-UNIT-004 | 單元測試 | P0     | 面板比例計算邏輯            | 數學計算準確性 |
| 1.2-UNIT-005 | 單元測試 | P1     | 摺疊狀態管理邏輯            | 狀態轉換正確性 |
| 1.2-INT-002  | 整合測試 | P0     | 佈局與狀態管理整合          | 多組件協調     |
| 1.2-E2E-002  | E2E 測試 | P0     | 響應式佈局 - 桌面/平板/手機 | 關鍵使用者體驗 |

### AC3: 可調整分隔線

分隔線可拖拽調整面板比例，最小寬度限制，雙點擊重置為預設比例，拖拽時的視覺反饋

#### 測試情境

| ID           | 測試層級 | 優先級 | 測試描述               | 理由           |
| ------------ | -------- | ------ | ---------------------- | -------------- |
| 1.2-UNIT-006 | 單元測試 | P0     | 拖拽位置計算與邊界限制 | 核心算法邏輯   |
| 1.2-UNIT-007 | 單元測試 | P0     | 雙點擊重置功能         | 關鍵使用者操作 |
| 1.2-INT-003  | 整合測試 | P1     | 拖拽事件與狀態更新整合 | 事件處理完整性 |
| 1.2-E2E-003  | E2E 測試 | P0     | 分隔線拖拽使用者體驗   | 核心互動功能   |

### AC4: 編輯器功能特性

基本快速鍵支援，行號顯示，程式碼摺疊功能，尋找和取代功能，多游標編輯

#### 測試情境

| ID           | 測試層級 | 優先級 | 測試描述                   | 理由           |
| ------------ | -------- | ------ | -------------------------- | -------------- |
| 1.2-UNIT-008 | 單元測試 | P1     | 快速鍵映射配置             | 功能配置準確性 |
| 1.2-INT-004  | 整合測試 | P1     | Monaco Editor 進階功能整合 | 複雜功能協調   |
| 1.2-E2E-004  | E2E 測試 | P1     | 編輯器快速鍵使用流程       | 使用者工作流程 |

### AC5: 主題切換功能

暗色主題為預設，提供亮色主題選項，主題切換按鈕，系統主題同步

#### 測試情境

| ID           | 測試層級 | 優先級 | 測試描述             | 理由           |
| ------------ | -------- | ------ | -------------------- | -------------- |
| 1.2-UNIT-009 | 單元測試 | P1     | 主題狀態管理邏輯     | 狀態轉換準確性 |
| 1.2-UNIT-010 | 單元測試 | P2     | 系統主題偵測邏輯     | 環境適應性     |
| 1.2-INT-005  | 整合測試 | P1     | 主題與編輯器樣式整合 | 樣式一致性     |
| 1.2-E2E-005  | E2E 測試 | P1     | 主題切換使用者體驗   | 視覺體驗驗證   |

### AC6: 預覽面板基礎

即時預覽區域，載入狀態指示器，錯誤顯示區域，空白狀態提示

#### 測試情境

| ID           | 測試層級 | 優先級 | 測試描述                 | 理由           |
| ------------ | -------- | ------ | ------------------------ | -------------- |
| 1.2-UNIT-011 | 單元測試 | P1     | 預覽狀態管理             | 狀態機正確性   |
| 1.2-INT-006  | 整合測試 | P1     | 編輯器與預覽面板狀態同步 | 即時更新機制   |
| 1.2-E2E-006  | E2E 測試 | P2     | 預覽面板各狀態顯示       | 使用者回饋體驗 |

### AC7: 響應式適配

桌面版雙面板並排顯示，平板版可切換的全寬模式，手機版垂直堆疊佈局，觸控友善的操作界面

#### 測試情境

| ID           | 測試層級 | 優先級 | 測試描述         | 理由           |
| ------------ | -------- | ------ | ---------------- | -------------- |
| 1.2-UNIT-012 | 單元測試 | P2     | 視窗尺寸偵測邏輯 | 環境感知準確性 |

_註：響應式適配主要在 1.2-E2E-002 中整合測試_

## 風險覆蓋映射

基於風險評估結果，重點測試項目：

### 高風險緩解 (TECH-001: Monaco Editor 動態載入失敗)

- **1.2-INT-001**: Monaco Editor 與狀態整合測試
- **1.2-E2E-001**: 編輯器載入端到端驗證
- **額外建議**: 新增網路中斷情境測試

### 中風險緩解

- **SEC-001** (Mermaid 程式碼注入): 建議新增輸入驗證測試
- **TECH-002** (面板拖拽效能): 1.2-E2E-003 包含效能驗證
- **SEC-002** (本地儲存安全): 現有測試已涵蓋

## 測試執行優先順序建議

### 階段 1: 關鍵功能驗證 (P0)

1. **1.2-UNIT-001** - Mermaid 語言註冊
2. **1.2-UNIT-002** - 自動補全功能
3. **1.2-UNIT-004** - 面板比例計算
4. **1.2-UNIT-006** - 拖拽位置計算
5. **1.2-UNIT-007** - 雙點擊重置
6. **1.2-INT-001** - Monaco Editor 整合
7. **1.2-INT-002** - 佈局狀態整合
8. **1.2-E2E-002** - 響應式佈局
9. **1.2-E2E-003** - 分隔線拖拽

### 階段 2: 核心體驗驗證 (P1)

1. **1.2-UNIT-003** - 主題定義
2. **1.2-UNIT-005** - 摺疊狀態管理
3. **1.2-UNIT-008** - 快速鍵映射
4. **1.2-UNIT-009** - 主題狀態管理
5. **1.2-UNIT-011** - 預覽狀態管理
6. **1.2-INT-003** - 拖拽事件整合
7. **1.2-INT-004** - Monaco 進階功能
8. **1.2-INT-005** - 主題樣式整合
9. **1.2-INT-006** - 編輯器預覽同步
10. **1.2-E2E-001** - 編輯器載入體驗
11. **1.2-E2E-004** - 快速鍵流程
12. **1.2-E2E-005** - 主題切換體驗

### 階段 3: 補充功能驗證 (P2)

1. **1.2-UNIT-010** - 系統主題偵測
2. **1.2-UNIT-012** - 視窗尺寸偵測
3. **1.2-E2E-006** - 預覽面板狀態

## 測試資料需求

### 基礎測試資料

```yaml
mermaid_samples:
  simple_graph: "graph TD\n  A --> B"
  complex_graph: "graph LR\n  A[Start] --> B{Decision}\n  B -->|Yes| C[Action 1]\n  B -->|No| D[Action 2]"
  invalid_syntax: "graph invalid\n  broken --> syntax"
  large_graph: '包含 100+ 節點的大型圖表'

viewport_sizes:
  desktop: '1920x1080'
  tablet: '768x1024'
  mobile: '375x667'

interaction_patterns:
  drag_positions: [0.2, 0.3, 0.5, 0.7, 0.8]
  keyboard_combinations: ['Ctrl+S', 'Ctrl+Z', 'Ctrl+Y', 'Ctrl+F']
```

## 測試環境需求

### 瀏覽器支援

- **必須測試**: Chrome (latest), Firefox (latest), Safari (latest)
- **建議測試**: Edge (latest), Chrome Mobile, Safari Mobile

### 裝置類型

- **桌面**: 1920x1080, 1366x768
- **平板**: iPad (768x1024), Android Tablet (800x1280)
- **手機**: iPhone SE (375x667), Android (360x640)

## 覆蓋率目標

### 功能覆蓋率

- **P0 功能**: 100% 覆蓋率 (必須)
- **P1 功能**: 95% 覆蓋率 (目標)
- **P2 功能**: 80% 覆蓋率 (可接受)

### 程式碼覆蓋率

- **關鍵組件**: >90%
- **一般組件**: >80%
- **工具函數**: >95%

## 品質檢查清單

- [✅] 每個 AC 都有測試覆蓋
- [✅] 測試層級分配合理 (避免過度測試)
- [✅] 無重複覆蓋問題
- [✅] 優先級與業務風險對齊
- [✅] 測試 ID 遵循命名規範
- [✅] 測試情境原子化且獨立

## 長期維護考量

### 測試維護策略

1. **單元測試**: 高度維護，隨程式碼變更同步更新
2. **整合測試**: 中等維護，關注 API 變更
3. **E2E 測試**: 低度維護，專注使用者流程穩定性

### 自動化建議

- 所有 P0 和 P1 測試應完全自動化
- P2 測試可考慮半自動化或手動執行
- 建立測試結果趨勢監控

---

**測試設計完成時間**: 2025-09-01  
**預估總測試執行時間**: P0 (2小時) + P1 (4小時) + P2 (2小時) = 8小時  
**下一步**: 全面審查整合
